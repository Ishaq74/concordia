---
import Card from "@components/ui/Card/Card.astro";
import CardHeader from "@components/ui/Card/CardHeader.astro";
import CardContent from "@components/ui/Card/CardContent.astro";
import CardFooter from "@components/ui/Card/CardFooter.astro";
import FormGroup from "@components/ui/Form/FormGroup.astro";
import Label from "@components/ui/Form/Label.astro";
import Input from "@components/ui/Form/Input.astro";
import Button from "@components/ui/Button.astro";
import Alert from "@components/ui/Alert.astro";
import Link from "@components/ui/Link.astro";

interface Props {
    translations?: Record<string, any>;
    title?: string;
    status?: { type: "success" | "error"; message: string } | null;
    lastEmail?: string;
}

const props = Astro.props as Props;
const translations = props.translations ?? {};
const t = (translations?.auth ?? translations) as Record<string, any>;
const title = props.title ?? t.forgotPassword ?? "Mot de passe oublié ?";
const status = props.status ?? null;
const lastEmail = props.lastEmail ?? "";

const resolveRoute = (value: unknown, fallback: string) => {
    return typeof value === "string" && value.startsWith("/")
        ? value
        : fallback;
};

const loginUrl = resolveRoute(
    t.loginPageUrl ?? translations.loginPageUrl,
    "/fr/auth/connexion",
);
const backToLoginLabel =
    t.backToLogin ?? translations.backToLogin ?? "Retour à la connexion";
---

<Card className="auth-card">
    <CardHeader>
        <h1 class="auth-title">{title}</h1>
        <p class="auth-subtitle">
            {
                t.forgotPasswordDescription ??
                    "Entrez votre email pour recevoir un lien de réinitialisation."
            }
        </p>
    </CardHeader>

    <CardContent className="auth-content">
        {
            status && (
                <Alert
                    status={status.type === "error" ? "error" : "success"}
                    aria-live="assertive"
                >
                    {status.message}
                </Alert>
            )
        }

        <form method="POST" class="auth-form">
            <FormGroup>
                <Label htmlFor="email">{t.emailLabel ?? "Adresse email"}</Label>
                <Input
                    id="email"
                    name="email"
                    type="email"
                    value={lastEmail}
                    required
                    autocomplete="email"
                    placeholder="nom@exemple.com"
                />
            </FormGroup>

            <Button type="submit" class="auth-submit-btn">
                {t.sendResetLink ?? "Envoyer le lien"}
            </Button>
        </form>
    </CardContent>

    <CardFooter className="auth-footer">
        <Link href={loginUrl} class="back-link">
            {backToLoginLabel}
        </Link>
    </CardFooter>
</Card>

<style>
    .auth-card {
        width: 100%;
        max-width: 28rem; /* max-w-md */
        margin-left: auto;
        margin-right: auto;
        margin-block: 1.5rem;
    }

    .auth-title {
        font-size: 1.5rem; /* text-2xl */
        font-weight: 600; /* font-semibold */
        color: var(--color-slate-900, #0f172a);
        margin: 0;
    }

    :global([data-theme="dark"]) .auth-title {
        color: var(--color-slate-50, #f8fafc);
    }

    .auth-subtitle {
        color: var(--color-slate-500, #64748b);
        font-size: 0.875rem; /* text-sm */
        margin-top: 0.5rem;
    }

    .auth-content {
        display: flex;
        flex-direction: column;
        gap: 1.25rem; /* space-y-5 */
    }

    .auth-form {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* space-y-4 */
    }

    .auth-submit-btn {
        width: 100%;
    }

    .auth-footer {
        display: flex;
        justify-content: center;
        border-top: 1px solid var(--color-slate-100, #f1f5f9);
        padding-top: 1rem;
        margin-top: 0.5rem;
    }

    :global([data-theme="dark"]) .auth-footer {
        border-color: var(--color-slate-800, #1e293b);
    }

    .back-link {
        font-size: 0.875rem; /* text-sm */
        color: var(--color-slate-600, #475569);
        text-decoration: none;
    }

    .back-link:hover {
        color: var(--color-slate-900, #0f172a);
    }

    :global([data-theme="dark"]) .back-link {
        color: var(--color-slate-400, #94a3b8);
    }

    :global([data-theme="dark"]) .back-link:hover {
        color: var(--color-slate-200, #e2e8f0);
    }
</style>
