---
import Card from "@components/ui/Card/Card.astro";
import CardHeader from "@components/ui/Card/CardHeader.astro";
import CardContent from "@components/ui/Card/CardContent.astro";
import FormGroup from "@components/ui/Form/FormGroup.astro";
import Label from "@components/ui/Form/Label.astro";
import PasswordInput from "@components/ui/Form/PasswordInput.astro";
import Button from "@components/ui/Button.astro";
import Alert from "@components/ui/Alert.astro";

interface Props {
    translations?: Record<string, any>;
    status?: { type: "success" | "error"; message: string } | null;
    token?: string;
}

const props = Astro.props as Props;
const translations = props.translations ?? {};
const t = (translations?.auth ?? translations) as Record<string, any>;
const status = props.status ?? null;
const token = props.token ?? "";
---

<Card className="auth-card">
    <CardHeader>
        <h1 class="auth-title">
            {t.resetPassword ?? "Réinitialiser le mot de passe"}
        </h1>
        <p class="auth-subtitle">
            {
                t.resetPasswordDescription ??
                    "Choisissez un nouveau mot de passe sécurisé."
            }
        </p>
    </CardHeader>

    <CardContent className="auth-content">
        {
            status && (
                <Alert
                    status={status.type === "error" ? "error" : "success"}
                    aria-live="assertive"
                >
                    {status.message}
                </Alert>
            )
        }

        {
            (!status || status.type === "error") && (
                <form method="POST" class="auth-form">
                    <input type="hidden" name="token" value={token} />

                    <FormGroup>
                        <Label htmlFor="password">
                            {t.passwordLabel ?? "Nouveau mot de passe"}
                        </Label>
                        <PasswordInput
                            id="password"
                            name="password"
                            required
                            autocomplete="new-password"
                        />
                    </FormGroup>

                    <FormGroup>
                        <Label htmlFor="confirmPassword">
                            {t.confirmPasswordLabel ??
                                "Confirmer le mot de passe"}
                        </Label>
                        <PasswordInput
                            id="confirmPassword"
                            name="confirmPassword"
                            required
                            autocomplete="new-password"
                        />
                    </FormGroup>

                    <Button type="submit" class="auth-submit-btn">
                        {t.resetPasswordButton ?? "Changer le mot de passe"}
                    </Button>
                </form>
            )
        }
    </CardContent>
</Card>

<style>
    .auth-card {
        width: 100%;
        max-width: 28rem; /* max-w-md */
        margin-left: auto;
        margin-right: auto;
        margin-block: 1.5rem;
    }

    .auth-title {
        font-size: 1.5rem; /* text-2xl */
        font-weight: 600; /* font-semibold */
        color: var(--color-slate-900, #0f172a);
        margin: 0;
    }

    :global([data-theme="dark"]) .auth-title {
        color: var(--color-slate-50, #f8fafc);
    }

    .auth-subtitle {
        color: var(--color-slate-500, #64748b);
        font-size: 0.875rem; /* text-sm */
        margin-top: 0.5rem;
    }

    .auth-content {
        display: flex;
        flex-direction: column;
        gap: 1.25rem; /* space-y-5 */
    }

    .auth-form {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* space-y-4 */
    }

    .auth-submit-btn {
        width: 100%;
    }
</style>
