---
import { getRelativeLocaleUrl } from "@lib/i18n/locale-url";
import { Icon } from 'astro-icon/components';

interface Props {
  variant?: 'initial' | 'retro' | 'modern' | 'futuristic';
  config?: {
    showSocial?: boolean;
    showNavPrimary?: boolean;
    showContactInfo?: boolean;
    showLegalInfo?: boolean;
    showAddress?: boolean;
    showCopyright?: boolean;
  };
  class?: string;
}

const {
  variant = 'initial',
  config = {
    showSocial: true,
    showNavPrimary: true,
    showContactInfo: true,
    showLegalInfo: true,
    showAddress: true,
    showCopyright: true,
  },
  class: className = '',
} = Astro.props;

const currentLocale = Astro.currentLocale || 'fr';

// Import translations
const translations = await import(`../../../i18n/${currentLocale}.json`);
const t = translations.default;

const footerClass = [
  'footer',
  variant !== 'initial' && variant,
  className
].filter(Boolean).join(' ');

const currentYear = new Date().getFullYear();

const isFr = currentLocale === 'fr';

// Social links
const socialLinks = [
  { name: 'Facebook', icon: 'mdi:facebook', href: 'https://facebook.com/concordia-annecy' },
  { name: 'Instagram', icon: 'mdi:instagram', href: 'https://instagram.com/concordia_annecy' },
  { name: 'Twitter', icon: 'mdi:twitter', href: 'https://twitter.com/concordia_ancy' },
];

// Footer nav columns
const discoverLinks = [
  { label: t.nav.places, href: getRelativeLocaleUrl(currentLocale, 'places') },
  { label: t.nav.events, href: getRelativeLocaleUrl(currentLocale, isFr ? 'evenements' : 'events') },
  { label: t.nav.trails, href: getRelativeLocaleUrl(currentLocale, isFr ? 'sentiers' : 'trails') },
  { label: t.nav.blog, href: getRelativeLocaleUrl(currentLocale, isFr ? 'blog' : 'blog') },
];

const communityLinks = [
  { label: t.nav.forum, href: getRelativeLocaleUrl(currentLocale, 'forum') },
  { label: t.nav.groups, href: getRelativeLocaleUrl(currentLocale, isFr ? 'groupes' : 'groups') },
  { label: t.nav.classifieds, href: getRelativeLocaleUrl(currentLocale, isFr ? 'annonces' : 'classifieds') },
  { label: t.nav.services, href: getRelativeLocaleUrl(currentLocale, 'services') },
];

const engageLinks = [
  { label: t.nav.volunteer, href: getRelativeLocaleUrl(currentLocale, isFr ? 'benevolat' : 'volunteer') },
  { label: t.nav.education, href: getRelativeLocaleUrl(currentLocale, 'education') },
  { label: t.nav.funding, href: getRelativeLocaleUrl(currentLocale, isFr ? 'financement' : 'funding') },
  { label: t.nav.transparency, href: getRelativeLocaleUrl(currentLocale, isFr ? 'transparence' : 'transparency') },
];
---

<footer class={footerClass}>
  <div class="footer-container">
    
    <div class="footer-grid">
      
      <!-- Company Info -->
      <div class="footer-section footer-brand">
        <h3 class="footer-title">{t.footer.company}</h3>
        <p class="footer-text">{t.footer.description}</p>
        <p class="footer-text footer-siret">{t.footer.siret}</p>
      </div>
      
      <!-- Découvrir -->
      {config.showNavPrimary && (
        <div class="footer-section">
          <h3 class="footer-title">{t.footer.navDiscover}</h3>
          <ul class="footer-list">
            {discoverLinks.map((link) => (
              <li><a href={link.href} class="footer-link">{link.label}</a></li>
            ))}
          </ul>
        </div>
      )}
      
      <!-- Communauté -->
      {config.showNavPrimary && (
        <div class="footer-section">
          <h3 class="footer-title">{t.footer.navCommunity}</h3>
          <ul class="footer-list">
            {communityLinks.map((link) => (
              <li><a href={link.href} class="footer-link">{link.label}</a></li>
            ))}
          </ul>
        </div>
      )}

      <!-- S'engager -->
      {config.showNavPrimary && (
        <div class="footer-section">
          <h3 class="footer-title">{t.footer.navEngage}</h3>
          <ul class="footer-list">
            {engageLinks.map((link) => (
              <li><a href={link.href} class="footer-link">{link.label}</a></li>
            ))}
          </ul>
        </div>
      )}
      
      <!-- Contact Info -->
      {config.showContactInfo && (
        <div class="footer-section">
          <h3 class="footer-title">{t.footer.contact}</h3>
          <ul class="footer-list">
            <li>
              <a href={`mailto:${t.footer.email}`} class="footer-link">
                <Icon name="mdi:email" class="footer-icon" />
                {t.footer.email}
              </a>
            </li>
            <li>
              <a href={`tel:${t.footer.phone.replace(/\s/g, '')}`} class="footer-link">
                <Icon name="mdi:phone" class="footer-icon" />
                {t.footer.phone}
              </a>
            </li>
          </ul>
          {config.showAddress && (
            <address class="footer-address">
              <p class="footer-text">{t.footer.street}</p>
              <p class="footer-text">{t.footer.city}</p>
            </address>
          )}
        </div>
      )}
      
      <!-- Social Links -->
      {config.showSocial && (
        <div class="footer-section">
          <h3 class="footer-title">{t.footer.followUs}</h3>
          <div class="footer-social">
            {socialLinks.map((social) => (
              <a href={social.href} class="footer-social-link" aria-label={social.name} target="_blank" rel="noopener noreferrer">
                <Icon name={social.icon} />
              </a>
            ))}
          </div>
        </div>
      )}
      
    </div>
    
    <!-- Bottom Bar -->
    <div class="footer-bottom">
      
      <!-- Legal Links -->
      {config.showLegalInfo && (
        <div class="footer-legal">
          <a href={getRelativeLocaleUrl(currentLocale, 'legal')} class="footer-link">{t.footer.legal}</a>
          <span class="footer-separator">•</span>
          <a href={getRelativeLocaleUrl(currentLocale, 'privacy')} class="footer-link">{t.footer.privacy}</a>
          <span class="footer-separator">•</span>
          <a href={getRelativeLocaleUrl(currentLocale, 'terms')} class="footer-link">{t.footer.terms}</a>
        </div>
      )}
      
      <!-- Copyright -->
      {config.showCopyright && (
        <div class="footer-copyright">
          <p class="footer-text">© {currentYear} {t.footer.company}. {t.footer.copyright}</p>
        </div>
      )}
      
    </div>
    
  </div>
</footer>
