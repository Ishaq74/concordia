---
import Dropdown from "@components/ui/Dropdown.astro";
import { getRelativeLocaleUrl } from "@lib/i18n/locale-url";

interface Props {
  variant?: "initial" | "retro" | "modern" | "futuristic";
  isMenu?: boolean;
  class?: string;
}

const {
  variant = "initial",
  isMenu = false,
  class: className = "",
} = Astro.props;

const currentLocale = Astro.currentLocale;
const currentPath = Astro.url.pathname;

const translations = await import(`../../../i18n/${currentLocale}.json`);
const t = translations.default;

const navClass = ["nav", variant !== "initial" && variant, className]
  .filter(Boolean)
  .join(" ");

// Locale-aware slug mapping
const isFr = currentLocale === "fr";

// Découvrir: Places, Sentiers, Blog, Événements
const discoverItems = [
  {
    label: t.nav.places,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "places" : "places"),
  },
  {
    label: t.nav.trails,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "sentiers" : "trails"),
  },
  {
    label: t.nav.blog,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "blog" : "blog"),
  },
  {
    label: t.nav.events,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "evenements" : "events"),
  },
];

// Communauté: Forum, Groupes, Annonces, Services
const communityItems = [
  {
    label: t.nav.forum,
    href: getRelativeLocaleUrl(currentLocale, "forum"),
  },
  {
    label: t.nav.groups,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "groupes" : "groups"),
  },
  {
    label: t.nav.classifieds,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "annonces" : "classifieds"),
  },
  {
    label: t.nav.services,
    href: getRelativeLocaleUrl(currentLocale, "services"),
  },
];

// S'engager: Bénévolat, Éducation, Financement, Transparence
const engageItems = [
  {
    label: t.nav.volunteer,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "benevolat" : "volunteer"),
  },
  {
    label: t.nav.education,
    href: getRelativeLocaleUrl(currentLocale, "education"),
  },
  {
    label: t.nav.funding,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "financement" : "funding"),
  },
  {
    label: t.nav.transparency,
    href: getRelativeLocaleUrl(currentLocale, isFr ? "transparence" : "transparency"),
  },
];
---

<nav class={navClass}>
  <a
    href={getRelativeLocaleUrl(currentLocale, "")}
    class:list={["nav-link", { active: currentPath === getRelativeLocaleUrl(currentLocale, "") }]}
  >
    {t.nav.home}
  </a>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={discoverItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.discover}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={communityItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.community}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={engageItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.engage}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>

  <a
    href={getRelativeLocaleUrl(currentLocale, "docs")}
    class:list={["nav-link", { active: currentPath.startsWith(getRelativeLocaleUrl(currentLocale, "docs")) }]}
  >
    {t.nav.docs}
  </a>
</nav>
