---
import Dropdown from "@components/ui/Dropdown.astro";
import { getRelativeLocaleUrl } from "astro:i18n";

interface Props {
  variant?: "initial" | "retro" | "modern" | "futuristic";
  isMenu?: boolean; // Mobile-optimized mode
  class?: string;
}

const {
  variant = "initial",
  isMenu = false,
  class: className = "",
} = Astro.props;

const currentLocale = Astro.currentLocale || "fr";
const currentPath = Astro.url.pathname;

// Import translations
const translations = await import(`../../../i18n/${currentLocale}.json`);
const t = translations.default;

const navClass = ["nav", variant !== "initial" && variant, className]
  .filter(Boolean)
  .join(" ");

// Menu items pour les dropdowns
const servicesItems = [
  {
    label: t.services.consulting,
    href: getRelativeLocaleUrl(currentLocale, "services/consulting"),
  },
  {
    label: t.services.development,
    href: getRelativeLocaleUrl(currentLocale, "services/development"),
  },
  {
    label: t.services.design,
    href: getRelativeLocaleUrl(currentLocale, "services/design"),
  },
];

const blogItems = [
  {
    label: t.blog.news,
    href: getRelativeLocaleUrl(currentLocale, "blog/news"),
  },
  {
    label: t.blog.tutorials,
    href: getRelativeLocaleUrl(currentLocale, "blog/tutorials"),
  },
  {
    label: t.blog.releases,
    href: getRelativeLocaleUrl(currentLocale, "blog/releases"),
  },
];

const docsItems = [
  {
    label: t.docs.ui,
    href: getRelativeLocaleUrl(currentLocale, "docs/ui"),
    children: [
      {
        label: t.docs.design,
        href: getRelativeLocaleUrl(currentLocale, "docs/design"),
        children: [
          {
            label: t.docs.colors,
            href: getRelativeLocaleUrl(currentLocale, "docs/design/colors"),
          },
          {
            label: t.docs.typography,
            href: getRelativeLocaleUrl(currentLocale, "docs/design/typography"),
          },
          {
            label: t.docs.spacing,
            href: getRelativeLocaleUrl(currentLocale, "docs/design/spacing"),
          },
          {
            label: t.docs.shadows,
            href: getRelativeLocaleUrl(currentLocale, "docs/design/shadows"),
          },
          {
            label: t.docs.borders,
            href: getRelativeLocaleUrl(currentLocale, "docs/design/borders"),
          },
        ],
      },
    ],
  },
  {
    label: t.docs.components,
    href: getRelativeLocaleUrl(currentLocale, "docs/components"),
  },
  {
    label: t.docs.data,
    href: getRelativeLocaleUrl(currentLocale, "docs/data"),
    children: [
      {
        label: t.docs.layouts,
        href: getRelativeLocaleUrl(currentLocale, "docs/data/layouts"),
      },
      {
        label: t.docs.entities,
        href: getRelativeLocaleUrl(currentLocale, "docs/data/entities"),
      },
    ],
  },
];
---

<nav class={navClass}>
  <a
    href={getRelativeLocaleUrl(currentLocale, "")}
    class={[
      "nav-link",
      currentPath === getRelativeLocaleUrl(currentLocale, "") && "active",
    ]
      .filter(Boolean)
      .join(" ")}
  >
    {t.nav.home}
  </a>

  <a
    href={getRelativeLocaleUrl(currentLocale, "about")}
    class={[
      "nav-link",
      currentPath.startsWith(getRelativeLocaleUrl(currentLocale, "about")) &&
        "active",
    ]
      .filter(Boolean)
      .join(" ")}
  >
    {t.nav.about}
  </a>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={servicesItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.services}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={blogItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.blog}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>

  <a
    href={getRelativeLocaleUrl(currentLocale, "contact")}
    class={[
      "nav-link",
      currentPath.startsWith(getRelativeLocaleUrl(currentLocale, "contact")) &&
        "active",
    ]
      .filter(Boolean)
      .join(" ")}
  >
    {t.nav.contact}
  </a>

  <div class="nav-dropdown-wrapper">
    <Dropdown
      items={docsItems}
      variant={variant}
      position="bottom-left"
      triggerLabel={t.nav.docs}
      ishover={true}
      ismenu={isMenu}
      class="nav-dropdown"
    />
  </div>
</nav>
