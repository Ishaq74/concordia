---
// Flex component: DX identique Ã  Grid, spacing tokens stricts, margin/padding complets
interface Props {
  direction?: 'row' | 'row-reverse' | 'column' | 'column-reverse';
  wrap?: 'nowrap' | 'wrap' | 'wrap-reverse';
  alignItems?: 'flex-start' | 'center' | 'flex-end' | 'baseline' | 'stretch';
  justifyContent?: 'flex-start' | 'center' | 'flex-end' | 'space-between' | 'space-around' | 'space-evenly';
  gap?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  padding?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  margin?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  paddingTop?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  paddingBottom?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  paddingLeft?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  paddingRight?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  marginTop?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  marginBottom?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  marginLeft?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  marginRight?: 'none' | 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'xxl';
  className?: string;
  style?: string;
  [key: string]: any;
}

const spacingTokens = {
  none: '0',
  xs: 'var(--space-1)',
  sm: 'var(--space-2)',
  md: 'var(--space-4)',
  lg: 'var(--space-6)',
  xl: 'var(--space-8)',
  xxl: 'var(--space-10)',
} as const;
type SpacingKey = keyof typeof spacingTokens;
function getSpacingToken(val: SpacingKey | undefined): string {
  if (!val) return '';
  return spacingTokens[val] ?? '';
}

const {
  direction = 'row',
  wrap = 'nowrap',
  alignItems = 'stretch',
  justifyContent = 'flex-start',
  gap = 'md',
  padding,
  margin,
  paddingTop,
  paddingBottom,
  paddingLeft,
  paddingRight,
  marginTop,
  marginBottom,
  marginLeft,
  marginRight,
  className = '',
  style: inlineStyle = '',
  ...restProps
} = Astro.props as Props;

const styles: Record<string, string> = {
  gap: getSpacingToken(gap),
  padding: getSpacingToken(padding),
  margin: getSpacingToken(margin),
  'padding-top': getSpacingToken(paddingTop),
  'padding-bottom': getSpacingToken(paddingBottom),
  'padding-left': getSpacingToken(paddingLeft),
  'padding-right': getSpacingToken(paddingRight),
  'margin-top': getSpacingToken(marginTop),
  'margin-bottom': getSpacingToken(marginBottom),
  'margin-left': getSpacingToken(marginLeft),
  'margin-right': getSpacingToken(marginRight),
};

const styleString = Object.entries(styles)
  .filter(([, v]) => typeof v === 'string' && v !== undefined && v !== '')
  .map(([k, v]) => `${k}:${v}`)
  .join(';') + (inlineStyle ? `;${inlineStyle}` : '');

const classes = [
  'flex',
  direction === 'column' && 'flex-col',
  direction === 'row-reverse' && 'flex-row-reverse',
  direction === 'column-reverse' && 'flex-col-reverse',
  wrap !== 'nowrap' && `flex-${wrap}`,
  alignItems && `items-${alignItems}`,
  justifyContent && `justify-${justifyContent}`,
  className
].filter(Boolean).join(' ');

---

<div class={classes} style={styleString} {...restProps}>
  <slot />
</div>

<style>
  .flex {
    display: flex;
  }
  .flex-col {
    flex-direction: column;
  }
  .flex-row-reverse {
    flex-direction: row-reverse;
  }
  .flex-col-reverse {
    flex-direction: column-reverse;
  }
  .flex-wrap {
    flex-wrap: wrap;
  }
  .flex-wrap-reverse {
    flex-wrap: wrap-reverse;
  }
  .items-flex-start { align-items: flex-start; }
  .items-center { align-items: center; }
  .items-flex-end { align-items: flex-end; }
  .items-baseline { align-items: baseline; }
  .items-stretch { align-items: stretch; }
  .justify-flex-start { justify-content: flex-start; }
  .justify-center { justify-content: center; }
  .justify-flex-end { justify-content: flex-end; }
  .justify-space-between { justify-content: space-between; }
  .justify-space-around { justify-content: space-around; }
  .justify-space-evenly { justify-content: space-evenly; }
</style>