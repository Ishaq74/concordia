---
/**
 * Sheet - Composant racine pour panneau coulissant (Pure CSS)
 * 
 * Panneau coulissant qui s'ouvre depuis le bord de l'écran.
 * Version pure CSS utilisant checkbox + :has() selector.
 * 
 * @param {string} id - ID unique pour le checkbox
 * @param {string} variant - Style variant (initial|retro|modern|futuristic)
 * @param {string} className - Classes CSS supplémentaires
 */

interface Props {
  id: string;
  variant?: 'initial' | 'retro' | 'modern' | 'futuristic';
  className?: string;
  [key: string]: any;
}

const {
  id,
  variant = 'initial',
  className = '',
  ...htmlAttributes
} = Astro.props as Props;

const variantClass = variant !== 'initial' ? `sheet-${variant}` : '';

const classes = [
  'sheet',
  variantClass,
  className,
].filter(Boolean).join(' ');
---

<div class={classes} {...htmlAttributes}>
  <input type="checkbox" id={id} class="sheet-toggle" />
  <slot />
</div>

<style>
  /* Sheet container */
  .sheet {
    position: relative;
  }

  /* Checkbox caché */
  .sheet-toggle {
    display: none;
  }

  /* Overlay - Variant Initial */
  :global(.sheet-overlay) {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 300ms ease-in-out;
    z-index: 9998;
    cursor: pointer;
    backdrop-filter: blur(0px);
  }

  /* Content de base - Variant Initial */
  :global(.sheet-content) {
    position: fixed;
    background-color: var(--bg-default);
    color: var(--text-default);
    box-shadow: var(--shadow-lg);
    transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 9999;
    padding: 0;
    border: 1px solid var(--border-default);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  /* Variantes par side avec responsive */
  :global(.sheet-content[data-side="right"]),
  :global(.sheet-content[data-side="left"]) {
    top: 0;
    bottom: 0;
    width: 90vw;
    max-width: 420px;
  }

  :global(.sheet-content[data-side="right"]) {
    right: 0;
    transform: translateX(100%);
  }

  :global(.sheet-content[data-side="left"]) {
    left: 0;
    transform: translateX(-100%);
  }

  :global(.sheet-content[data-side="top"]),
  :global(.sheet-content[data-side="bottom"]) {
    left: 0;
    right: 0;
    width: 100%;
    max-height: 85vh;
  }

  :global(.sheet-content[data-side="top"]) {
    top: 0;
    transform: translateY(-100%);
  }

  :global(.sheet-content[data-side="bottom"]) {
    bottom: 0;
    transform: translateY(100%);
  }

  /* État ouvert avec :has() */
  .sheet:has(.sheet-toggle:checked) :global(.sheet-overlay) {
    opacity: 1;
    pointer-events: auto;
  }

  .sheet:has(.sheet-toggle:checked) :global(.sheet-content) {
    transform: translate(0);
  }

  /* Cursor pour trigger et close */
  :global(.sheet-trigger),
  :global(.sheet-close) {
    cursor: pointer;
    user-select: none;
  }

  /* VARIANT RETRO */
  .sheet-retro :global(.sheet-overlay) {
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: none;
  }

  .sheet-retro :global(.sheet-content) {
    border: 2px solid var(--border-default);
    box-shadow: 
      8px 8px 0 rgba(0, 0, 0, 0.2),
      var(--shadow-xl);
  }

  /* VARIANT MODERN */
  .sheet-modern :global(.sheet-overlay) {
    backdrop-filter: blur(8px);
    background-color: rgba(0, 0, 0, 0.3);
  }

  .sheet-modern :global(.sheet-content) {
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--border-subtle);
    box-shadow: 
      var(--shadow-2xl),
      0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  }

  .sheet-modern :global(.sheet-content[data-side="right"]),
  .sheet-modern :global(.sheet-content[data-side="left"]) {
    border-radius: 0;
  }

  /* VARIANT FUTURISTIC */
  .sheet-futuristic :global(.sheet-overlay) {
    backdrop-filter: blur(12px) saturate(1.5);
    background: linear-gradient(
      135deg,
      rgba(99, 102, 241, 0.1) 0%,
      rgba(139, 92, 246, 0.1) 50%,
      rgba(236, 72, 153, 0.1) 100%
    );
  }

  .sheet-futuristic :global(.sheet-content) {
    background: var(--bg-default);
    border: 1px solid;
    border-image: linear-gradient(
      135deg,
      rgba(99, 102, 241, 0.5),
      rgba(139, 92, 246, 0.5),
      rgba(236, 72, 153, 0.5)
    ) 1;
    box-shadow: 
      var(--shadow-2xl),
      0 0 40px rgba(99, 102, 241, 0.2),
      0 0 80px rgba(139, 92, 246, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .sheet-futuristic :global(.sheet-content[data-side="right"]),
  .sheet-futuristic :global(.sheet-content[data-side="left"]) {
    border-radius: 0;
  }

  /* Responsive */
  @media (max-width: 640px) {
    :global(.sheet-content[data-side="right"]),
    :global(.sheet-content[data-side="left"]) {
      width: 100vw;
      max-width: 100vw;
    }

    :global(.sheet-content[data-side="top"]),
    :global(.sheet-content[data-side="bottom"]) {
      max-height: 90vh;
    }
  }

  @media (min-width: 768px) {
    :global(.sheet-content[data-side="right"]),
    :global(.sheet-content[data-side="left"]) {
      width: 85vw;
      max-width: 480px;
    }
  }

  @media (min-width: 1024px) {
    :global(.sheet-content[data-side="right"]),
    :global(.sheet-content[data-side="left"]) {
      width: 70vw;
      max-width: 520px;
    }
  }
</style>
